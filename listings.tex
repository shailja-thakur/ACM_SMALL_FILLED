% % Improved LaTeX listings for AAAI submission
% % Add these packages to your preamble if not already included:
% % \usepackage{tcolorbox}
% % \usepackage{xcolor}
% % \usepackage{listings}
% % \usepackage[dvipsnames]{xcolor}
% % \usepackage[most]{tcolorbox}
% % \usepackage{enumitem}

% % --- CUSTOM COLOR DEFINITIONS ---


% % Define colors for code-like appearance
% \definecolor{promptblue}{RGB}{0, 102, 204}
% \definecolor{lightgray}{RGB}{245, 245, 245}
% \definecolor{darkgray}{RGB}{64, 64, 64}
% \definecolor{commentgreen}{RGB}{0, 128, 0}
% \definecolor{keywordblue}{RGB}{0, 0, 255}
% \definecolor{stringred}{RGB}{163, 21, 21}

% \begin{figure}[t!]
% \centering

% \begin{tcolorbox}[
%     enhanced,
%     fontupper=\ttfamily\scriptsize,
%     colback=lightgray,
%     colframe=darkgray,
%     boxrule=0.8pt,
%     arc=3pt,
%     enlarge top by=0.5mm,
%     enlarge bottom by=0.5mm,
%     title={\scriptsize\textbf{Forward Chain-of-Thought Sample}},
%     coltitle=white,
%     colbacktitle=darkgray,
%     boxsep=2pt,
%     left=4pt,
%     right=4pt,
%     top=2pt,
%     bottom=2pt,
%     nobeforeafter,
%     before upper={\setlength{\parskip}{1pt}},
% ]

% {\color{promptblue}\textbf{<Instruction>}}

% You are given a Python function. Predict what the function will output given the input.

% {\color{promptblue}\textbf{<Function>}}

% [Function Signature and Docstring]

% {\color{promptblue}\textbf{<Question>}}

% What is the output of `function\_name` given the input?

% {\color{promptblue}\textbf{<CoT>}}
% \begin{enumerate}[leftmargin=8pt, itemsep=1pt, parsep=0pt]
% \item The function begins by initializing local variables (e.g., `counter=0`, `result=[]`).
% \item Based on the input `...`, the program enters a loop/conditional branch.  
% \item The state of variables is updated at each step, reflecting the execution trace.
% \item The final return value is computed based on the terminal state of the variables.
% \end{enumerate}

% {\color{promptblue}\textbf{<Predicted Output>}}

% [Final Output]

% \end{tcolorbox}
% {\footnotesize\textbf{(a) A forward sample reasons from input to output.}}

% \begin{tcolorbox}[
%     enhanced,
%     fontupper=\ttfamily\scriptsize,
%     colback=lightgray,
%     colframe=darkgray,
%     boxrule=0.8pt,
%     arc=3pt,
%     enlarge top by=0.5mm,
%     enlarge bottom by=0.5mm,
%     title={\scriptsize\textbf{Backward Chain-of-Thought Sample}},
%     coltitle=white,
%     colbacktitle=darkgray,
%     boxsep=2pt,
%     left=4pt,
%     right=4pt,
%     top=2pt,
%     bottom=2pt,
%     nobeforeafter,
%     before upper={\setlength{\parskip}{1pt}},
% ]

% {\color{promptblue}\textbf{<Instruction>}}

% You are given a Python function and its output. Predict what input could have produced this output.

% {\color{promptblue}\textbf{<Function>}}

% [Function Signature and Docstring]

% {\color{promptblue}\textbf{<Question>}}

% Given the function and the output, what input could have produced it?

% {\color{promptblue}\textbf{<CoT>}}
% \begin{enumerate}[leftmargin=8pt, itemsep=1pt, parsep=0pt]
% \item To obtain the output `...`, the function must have returned from line `L`.
% \item This requires the variable `...` to hold the value `...` at that point.
% \item Tracing backwards, to achieve this state, the preceding loop must have executed `N` times.
% \item For the loop to execute `N` times, the initial input must satisfy the condition `...`.
% \end{enumerate}

% {\color{promptblue}\textbf{<Plausible Input>}}

% [Predicted Input]

% \end{tcolorbox}
% {\footnotesize\textbf{(b) A backward sample reasons to plausible input.}}

% \caption{Abstract templates for the generated bi-directional CoT data.}
% \label{fig:cot-templates}
% \end{figure}






% Improved LaTeX listings for AAAI submission
% Add these packages to your preamble if not already included:
% \usepackage{tcolorbox}
% \usepackage{xcolor}
% \usepackage{listings}
% \usepackage[dvipsnames]{xcolor}
% \usepackage[most]{tcolorbox}
% \usepackage{enumitem}

% --- CUSTOM COLOR DEFINITIONS ---

 % \begin{table*}[t!]
  % \centering
  % \caption{Comprehensive evaluation results across models, datasets, and training configurations on CruxEval and LiveCodeBench benchmarks. The experiments follow a top-down approach, with the winning configuration
  % from
  %  one stage used in the next. Best results for each stage are highlighted in \textbf{bold}.}
  % \label{tab:comprehensive-results}
  % \resizebox{\textwidth}{!}{%
  % \begin{tabular}{l|l|l|c|c|c|cc|cc}
  % \hline
  % \multirow{2}{*}{\textbf{Experiment Stage}} & \multirow{2}{*}{\textbf{Model}} & \multirow{2}{*}{\textbf{Training Config}} & \multirow{2}{*}{\textbf{Data Subset}} & \multirow{2}{*}{\textbf{Data Config}} &
  % \textbf{LiveCodeBench-Exec} &
  % \multicolumn{2}{c|}{\textbf{CruxEval Output}} & \multicolumn{2}{c}{\textbf{CruxEval Input}} \\
  %  & & & & & \textbf{Pass@1} & \textbf{Pass@1} & \textbf{Pass@5} & \textbf{Pass@1} & \textbf{Pass@5} \\
  % \hline
  % \hline
  % % \multicolumn{9}{c}{\textit{Qwen2.5-7B Model Family}} \\
  % % \hline
  % \multirow{2}{*}{Baselines} & \multirow{2}{*}{Qwen2.5-7B} & Base (Pre-trained) & N/A & N/A & -- & -- & -- & -- & -- \\
  %  & & Instruct (General) & Standard & N/A & 21.7 & 32.5 & 40.6 & -- & -- \\
  % \hline
  % \multirow{3}{*}{1. Data Curation} & \multirow{6}{*}{Qwen2.5-7B} & \multirow{3}{*}{Fwd} & 18k & Difficulty-Filt. & 66.9 \textcolor{green}{(+45.2)} & 58.4 \textcolor{green}{(+25.9)} & 75.5 \textcolor{green}{(+34.9)} &
  % 13.5 & 27.4 \\
  %  & & & 25k (best perf.) & Correctness-Filt. & \textbf{67.0}$^{\dagger}$ \textcolor{green}{(+45.3)} & 57.5 \textcolor{green}{(+25.0)} & 73.9 \textcolor{green}{(+33.3)} & -- & -- \\
  %  & & & 54k & Full Set & 66.5 \textcolor{green}{(+44.8)} & \textbf{58.6}$^{\dagger}$ \textcolor{green}{(+26.1)} & \textbf{76.0}$^{\dagger}$ \textcolor{green}{(+35.4)} & -- & -- \\
  % \cline{1-1}\cline{3-10}
  % \multirow{3}{*}{2. Reasoning Direction} & & Fwd & TBD & TBD & -- & 57.5 & 73.9 & -- & -- \\
  %  & & Bwd & TBD & TBD & -- & 50.4 & 69.8 & -- & -- \\
  %  & & Bi-directional & TBD & TBD & -- & 59.7 & 75.4 & -- & -- \\
  % \hline
  % \hline
  % % \multicolumn{9}{c}{\textit{Granite-3.3-8B Model Family}} \\
  % % \hline
  % \multirow{2}{*}{Baselines} & \multirow{2}{*}{Granite-3.3-8B} & Base (Pre-trained) & N/A & N/A & -- & -- & -- & -- & -- \\
  %  & & Instruct (General) & Standard & N/A & -- & 21.8 & 32.9 & -- & -- \\
  % \hline
  % \multirow{3}{*}{1. Data Curation} & \multirow{6}{*}{Granite-3.3-8B} & \multirow{3}{*}{Fwd} & 18k & Difficulty-Filt. & 43.5 & 36.1 \textcolor{green}{(+14.3)} & 58.2 \textcolor{green}{(+25.3)} & 35.8 & 57.9 \\
  %  & & & 25k (best perf.) & Correctness-Filt. & \textbf{44.9}$^{\dagger}$ & \textbf{42.7}$^{\dagger}$ \textcolor{green}{(+20.9)} & \textbf{64.7}$^{\dagger}$ \textcolor{green}{(+31.8)} & \textbf{40.2}$^{\dagger}$ &
  % \textbf{63.5}$^{\dagger}$ \\
  %  & & & 54k & Full Set & 34.1 & 28.9 \textcolor{green}{(+7.1)} & 55.2 \textcolor{green}{(+22.3)} & 28.8 & 54.9 \\
  % \cline{1-1}\cline{3-10}
  % \multirow{3}{*}{2. Reasoning Direction} & & Fwd & 25k & Correctness-Filt. & 44.9 & 42.7 \textcolor{green}{(+20.9)} & 64.7 \textcolor{green}{(+31.8)} & 40.2 & 63.5 \\
  %  & & Bwd & 25k & Correctness-Filt. & 35.4 & 39.3 \textcolor{green}{(+17.5)} & 61.3 \textcolor{green}{(+28.4)} & -- & -- \\
  %  & & Bi-directional & 25k & Correctness-Filt. & \textbf{44.3} & \textbf{45.7}$^{\dagger}$ \textcolor{green}{(+23.9)} & \textbf{67.4}$^{\dagger}$ \textcolor{green}{(+34.5)} & -- & -- \\
  % \hline
  % \end{tabular}%
  % }
  % \footnotesize
  %  \textit{Note:} All Pass@k scores are reported as percentages. $^{\dagger}$ indicates the best result across all training configurations for each metric. Abbreviations: Filt. = Filtered, perf. = performing, Fwd: Forward only CoT samples, Bwd: Backward only CoT samples.
  % \end{table*}

  
% Define colors for code-like appearance
\definecolor{promptblue}{RGB}{0, 102, 204}
\definecolor{lightgray}{RGB}{245, 245, 245}
\definecolor{lightblue}{RGB}{240, 248, 255}
\definecolor{lightgreen}{RGB}{240, 255, 240}
\definecolor{darkgray}{RGB}{64, 64, 64}
\definecolor{commentgreen}{RGB}{0, 128, 0}
\definecolor{keywordblue}{RGB}{0, 0, 255}
\definecolor{stringred}{RGB}{163, 21, 21}

% \begin{figure}[t!]
% \centering

% \begin{tcolorbox}[
%     enhanced,
%     fontupper=\ttfamily\scriptsize,
%     colback=lightgray,
%     colframe=darkgray,
%     boxrule=0.8pt,
%     arc=3pt,
%     enlarge top by=0.5mm,
%     enlarge bottom by=0.5mm,
%     title={\scriptsize\textbf{Forward Chain-of-Thought Template}},
%     coltitle=white,
%     colbacktitle=darkgray,
%     boxsep=2pt,
%     left=4pt,
%     right=4pt,
%     top=2pt,
%     bottom=2pt,
%     nobeforeafter,
%     before upper={\setlength{\parskip}{1pt}},
% ]

% \colorbox{lightblue}{\parbox{\dimexpr\linewidth-2\fboxsep}{%
% {\color{promptblue}\textbf{<Instruction>}}

% You are given a Python function. Predict what the function will output given the input.

% {\color{promptblue}\textbf{<Function>}}

% [Function Signature and Docstring]

% {\color{promptblue}\textbf{<Question>}}

% What is the output of `function\_name` given the input?
% }}

% \vspace{2pt}

% \colorbox{lightgreen}{\parbox{\dimexpr\linewidth-2\fboxsep}{%
% {\color{promptblue}\textbf{<CoT>}}
% \begin{enumerate}[leftmargin=8pt, itemsep=1pt, parsep=0pt]
% \item The function begins by initializing local variables (e.g., `counter=0`, `result=[]`).
% \item Based on the input `...`, the program enters a loop/conditional branch.  
% \item The state of variables is updated at each step, reflecting the execution trace.
% \item The final return value is computed based on the terminal state of the variables.
% \end{enumerate}

% {\color{promptblue}\textbf{<Predicted Output>}}

% [Final Output]
% }}

% \end{tcolorbox}
% {\footnotesize\textbf{(a) A forward CoT sample from input to output.}}



% \begin{tcolorbox}[
%     enhanced,
%     fontupper=\ttfamily\scriptsize,
%     colback=lightgray,
%     colframe=darkgray,
%     boxrule=0.8pt,
%     arc=3pt,
%     enlarge top by=0.5mm,
%     enlarge bottom by=0.5mm,
%     title={\scriptsize\textbf{Backward Chain-of-Thought Template}},
%     coltitle=white,
%     colbacktitle=darkgray,
%     boxsep=2pt,
%     left=4pt,
%     right=4pt,
%     top=2pt,
%     bottom=2pt,
%     nobeforeafter,
%     before upper={\setlength{\parskip}{1pt}},
% ]

% \colorbox{lightblue}{\parbox{\dimexpr\linewidth-2\fboxsep}{%
% {\color{promptblue}\textbf{<Instruction>}}

% You are given a Python function and its output. Predict what input could have produced this output.

% {\color{promptblue}\textbf{<Function>}}

% [Function Signature and Docstring]

% {\color{promptblue}\textbf{<Question>}}

% Given the function and the output, what input could have produced it?
% }}

% \vspace{2pt}

% \colorbox{lightgreen}{\parbox{\dimexpr\linewidth-2\fboxsep}{%
% {\color{promptblue}\textbf{<CoT>}}
% \begin{enumerate}[leftmargin=8pt, itemsep=1pt, parsep=0pt]
% \item To obtain the output `...`, the function must have returned from line `L`.
% \item This requires the variable `...` to hold the value `...` at that point.
% \item Tracing backwards, to achieve this state, the preceding loop must have executed `N` times.
% \item For the loop to execute `N` times, the initial input must satisfy the condition `...`.
% \end{enumerate}

% {\color{promptblue}\textbf{<Predicted Input>}}

% [Plausible Input]
% }}

% \end{tcolorbox}
% {\footnotesize\textbf{(b) A backward sample CoT to plausible input.}}
% \caption{Abstract templates for the generated bi-directional CoT data. Blue-shaded regions show the input prompt components (instruction, function, and question), while green-shaded regions show the model's reasoning and output generation.}
% \label{fig:cot-templates}
% \end{figure}




\begin{figure}[t!]
  \centering

  \begin{tcolorbox}[
      enhanced,
      fontupper=\ttfamily\scriptsize,
      colback=lightgray,
      colframe=darkgray,
      boxrule=0.8pt,
      arc=3pt,
      enlarge top by=0.5mm,
      enlarge bottom by=0.5mm,
      title={\scriptsize\textbf{Forward Chain-of-Thought Example}},
      coltitle=white,
      colbacktitle=darkgray,
      boxsep=2pt,
      left=4pt,
      right=4pt,
      top=2pt,
      bottom=2pt,
      nobeforeafter,
      before upper={\setlength{\parskip}{1pt}},
  ]

  \colorbox{lightblue}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{%
  {\color{promptblue}\textbf{<Instruction>}}

  Given a weighted graph, find the most cost-effective path between two nodes.

  {\color{promptblue}\textbf{<Function>}}

  [find\_cheapest\_path code]

  {\color{promptblue}\textbf{<Question>}}

  For the given network \texttt{graph}, what is the minimum cost and corresponding route from node 'A' to 'F'?
  }}

  \vspace{2pt}

  \colorbox{lightgreen}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{%
  {\color{promptblue}\textbf{<CoT>}}
  \begin{enumerate}[leftmargin=8pt, itemsep=1pt, parsep=0pt]
  \item Initialize distances: 'A' to 0, all others to infinity. Priority queue `pq` starts with `('A', 0)`.
  \item Extract 'A' from `pq`. Update distances for neighbors 'B' and 'C'; add to `pq`.
  \item \dots
  \item Destination 'F' reached. Backtrack from predecessors to reconstruct path. Final cost is 7.
  \end{enumerate}

  {\color{promptblue}\textbf{<Predicted Output>}}

  (['A', 'C', 'E', 'F'], 7)
  }}

  \end{tcolorbox}
  {\footnotesize\textbf{(a) A forward CoT template.}}



  \begin{tcolorbox}[
      enhanced,
      fontupper=\ttfamily\scriptsize,
      colback=lightgray,
      colframe=darkgray,
      boxrule=0.8pt,
      arc=3pt,
      enlarge top by=0.5mm,
      enlarge bottom by=0.5mm,
      title={\scriptsize\textbf{Backward Chain-of-Thought Example}},
      coltitle=white,
      colbacktitle=darkgray,
      boxsep=2pt,
      left=4pt,
      right=4pt,
      top=2pt,
      bottom=2pt,
      nobeforeafter,
      before upper={\setlength{\parskip}{1pt}},
  ]

  \colorbox{lightblue}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{%
  {\color{promptblue}\textbf{<Instruction>}}

  Given a weighted graph, find a starting node for a cost-effective path.

  {\color{promptblue}\textbf{<Function>}}

  [find\_cheapest\_path code]

  {\color{promptblue}\textbf{<Question>}}

  For the given \texttt{graph}, what start node could result in a path to 'F' with a total cost of 7?
  }}

  \vspace{2pt}

  \colorbox{lightgreen}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{%
  {\color{promptblue}\textbf{<CoT>}}
  \begin{enumerate}[leftmargin=8pt, itemsep=1pt, parsep=0pt]
  \item The final path to 'F' has a cost of 7. To deduce the start, we must trace predecessors backwards.
  \item The predecessor of 'F' in a cost-7 path must be 'E'. The edge cost from 'E' to 'F' is 2, meaning the cost to reach 'E' must have been 5.
  \item \dots
  \item After backtracking through 'C', the trace confirms that starting at node 'A', only way to achieve specified total cost of 7 to reach 'F'.
  \end{enumerate}

  {\color{promptblue}\textbf{<Predicted Input>}}

  'A'
  }}

  \end{tcolorbox}
  {\footnotesize\textbf{(b) A backward CoT template.}}
  \caption{Abstract examples for the generated bi-directional CoT data. Blue-shaded regions show the input prompt components (instruction, function, and question), while green-shaded regions show
  the model's reasoning and output generation.}
  \label{fig:cot-templates}
  \end{figure}

\begin{figure}[t!]
  \centering
  \begin{minipage}[t]{0.48\columnwidth}
  \begin{tcolorbox}[
      enhanced,
      fontupper=\ttfamily\scriptsize,
      colback=lightgray,
      colframe=darkgray,
      boxrule=0.8pt,
      arc=3pt,
      enlarge top by=0.5mm,
      enlarge bottom by=0.5mm,
      title={\scriptsize\textbf{Function Signature}},
      coltitle=white,
      colbacktitle=darkgray,
      boxsep=2pt,
      left=4pt,
      right=4pt,
      top=2pt,
      bottom=2pt,
      nobeforeafter,
  ]
  Function: solution(\\
  \hspace*{1em}freq\_list: \\
  \hspace*{2em}list[tuple[\\
  \hspace*{3em}str, int]]) \\
  \hspace*{1em}-> dict[str, str]
  \end{tcolorbox}
  {\footnotesize\textbf{(a) Function format.}}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\columnwidth}
  \begin{tcolorbox}[
      enhanced,
      fontupper=\ttfamily\scriptsize,
      colback=lightgray,
      colframe=darkgray,
      boxrule=0.8pt,
      arc=3pt,
      enlarge top by=0.5mm,
      enlarge bottom by=0.5mm,
      title={\scriptsize\textbf{Class Signature}},
      coltitle=white,
      colbacktitle=darkgray,
      boxsep=2pt,
      left=4pt,
      right=4pt,
      top=2pt,
      bottom=2pt,
      nobeforeafter,
  ]
  Class: HuffmanTree; \\
  \_\_init\_\_(self, \\
  \hspace*{1em}freq\_list: \\
  \hspace*{2em}list[tuple[\\
  \hspace*{3em}str, int]]) \\
  \hspace*{1em}-> None; \\
  build\_tree(self) \\
  \hspace*{1em}-> tuple; \\
  get\_encoding(self) \\
  \hspace*{1em}-> dict[str, str]
  \end{tcolorbox}
  {\footnotesize\textbf{(b) Class format.}}
  \end{minipage}
  \caption{Signature format templates enforced via few-shot examples. These strict formats ensure type and naming consistency across candidate solutions and tests.}
  \label{fig:signature-formats}
\end{figure}

\begin{figure}[t!]
  \centering
  \begin{minipage}[t]{0.48\columnwidth}
  \begin{tcolorbox}[
      enhanced,
      fontupper=\ttfamily\scriptsize,
      colback=lightgreen,
      colframe=darkgray,
      boxrule=0.8pt,
      arc=3pt,
      enlarge top by=0.5mm,
      enlarge bottom by=0.5mm,
      title={\scriptsize\textbf{Correct Format}},
      coltitle=white,
      colbacktitle=darkgray,
      boxsep=2pt,
      left=4pt,
      right=4pt,
      top=2pt,
      bottom=2pt,
      nobeforeafter,
  ]
  def test\_basic(): \\
  \hspace*{1em}\# Test basic \\
  \hspace*{1em}assert \\
  \hspace*{2em}solution([1, \\
  \hspace*{3em}2, 3], 2) \\
  \hspace*{2em}== [1]
  \end{tcolorbox}
  {\footnotesize\textbf{(a) Direct call in assert.}}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\columnwidth}
  \begin{tcolorbox}[
      enhanced,
      fontupper=\ttfamily\scriptsize,
      colback=lightgray,
      colframe=red,
      boxrule=0.8pt,
      arc=3pt,
      enlarge top by=0.5mm,
      enlarge bottom by=0.5mm,
      title={\scriptsize\textbf{Prohibited Format}},
      coltitle=white,
      colbacktitle=red,
      boxsep=2pt,
      left=4pt,
      right=4pt,
      top=2pt,
      bottom=2pt,
      nobeforeafter,
  ]
  def test\_wrong(): \\
  \hspace*{1em}\# Variable \\
  \hspace*{1em}\# outside assert \\
  \hspace*{1em}lst = [1, 2, 3] \\
  \hspace*{1em}assert \\
  \hspace*{2em}solution(lst, \\
  \hspace*{3em}2) == [1]
  \end{tcolorbox}
  {\footnotesize\textbf{(b) Variable assignment.}}
  \end{minipage}
  \caption{Test format requirements. The correct format enables clean I/O extraction for trace generation, while the prohibited format complicates trace analysis with intermediate variable assignments.}
  \label{fig:test-formats}
\end{figure}